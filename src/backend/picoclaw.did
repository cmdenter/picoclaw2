type AgentConfig = record {
    persona : text;
    system_prompt : text;
    allowed_tools : vec text;
    api_key : opt text;
    model : text;
    api_endpoint : text;
    max_context_messages : nat32;
    max_response_bytes : nat64;
    allowed_callers : vec principal;
    compress_interval : nat32;
};

type Message = record {
    role : text;
    content : text;
    timestamp : nat64;
};

type PicoState = record {
    identity : text;
    thread : text;
    episodes : text;
    priors : text;
    updated_at : nat64;
    msg_id_at_compress : nat64;
};

type Metrics = record {
    total_calls : nat64;
    total_cycles_spent : nat64;
    total_messages : nat64;
    errors : nat64;
};

type UserProfile = record {
    name : text;
    avatar_url : text;
    updated_at : nat64;
};

type WebEntry = record {
    url : text;
    summary : text;
    timestamp : nat64;
};

type UserBalance = record {
    available_e8s : nat64;
    pending_e8s : nat64;
    total_deposited_e8s : nat64;
    total_withdrawn_e8s : nat64;
    tx_count : nat64;
    updated_at : nat64;
};

type TxRecord = record {
    tx_type : nat8;
    amount_e8s : nat64;
    fee_e8s : nat64;
    block_height : nat64;
    timestamp : nat64;
    status : nat8;
};

type TokenBalance = record {
    symbol : text;
    balance_raw : nat64;
    decimals : nat8;
};

type HttpHeader = record { name : text; value : text };
type HttpResponse = record { status : nat; headers : vec HttpHeader; body : vec nat8 };
type TransformArgs = record { response : HttpResponse; context : vec nat8 };

type IngressHttpRequest = record {
    method : text;
    url : text;
    headers : vec record { text; text };
    body : vec nat8;
};

type IngressHttpResponse = record {
    status_code : nat16;
    headers : vec record { text; text };
    body : vec nat8;
    upgrade : opt bool;
};

service : {
    // Admin
    "set_api_key" : (text) -> (variant { Ok : null; Err : text });
    "configure" : (AgentConfig) -> (variant { Ok : null; Err : text });
    "get_config_public" : () -> (AgentConfig) query;
    "get_key_hint" : () -> (variant { Ok : text; Err : text }) query;

    // Profile
    "set_profile" : (text, text) -> (variant { Ok : null; Err : text });
    "get_profile" : () -> (UserProfile) query;

    // Chat
    "chat" : (text) -> (variant { Ok : text; Err : text });
    "send_prompt_to_llm" : (text) -> (variant { Ok : text; Err : text });

    // History
    "get_history" : (nat64) -> (vec Message) query;
    "clear_history" : () -> (variant { Ok : nat64; Err : text });

    // PicoState (tiered memory â€” I:identity T:thread E:episodes P:priors)
    "get_notes" : () -> (PicoState) query;
    "clear_notes" : () -> (variant { Ok : null; Err : text });
    "compress_context" : () -> (variant { Ok : text; Err : text });

    // Web memory (PicoBrowse)
    "browse" : (text) -> (variant { Ok : text; Err : text });
    "get_web_memory" : () -> (vec WebEntry) query;
    "clear_web_memory" : () -> (variant { Ok : null; Err : text });


    // Wallet (NFT-gated)
    "is_wallet_owner" : () -> (bool) query;
    "wallet_connect" : () -> (variant { Ok : text; Err : text });
    "wallet_balance" : () -> (UserBalance) query;
    "wallet_deposit_address" : () -> (text) query;
    "wallet_notify_deposit" : () -> (variant { Ok : text; Err : text });
    "wallet_withdraw" : (nat64) -> (variant { Ok : text; Err : text });
    "wallet_tx_history" : (nat64) -> (vec TxRecord) query;

    // KongSwap (token swaps)
    "swap_quote" : (text, text, text) -> (variant { Ok : text; Err : text });
    "swap_execute" : (text, text, text) -> (variant { Ok : text; Err : text });
    "token_balances" : () -> (variant { Ok : vec TokenBalance; Err : text });

    // On-chain tools (free queries)
    "principal_to_account_id" : (text) -> (variant { Ok : text; Err : text }) query;

    // Monitoring
    "get_metrics" : () -> (Metrics) query;
    "cycle_balance" : () -> (nat) query;
    "get_queue_length" : () -> (nat64) query;

    // Transform (internal)
    "transform_llm_response" : (TransformArgs) -> (HttpResponse) query;

    // HTTP Gateway
    "http_request" : (IngressHttpRequest) -> (IngressHttpResponse) query;
    "http_request_update" : (IngressHttpRequest) -> (IngressHttpResponse);
}
